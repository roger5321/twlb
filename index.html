<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>台灣彩券即時開獎資訊看板</title>
    <style>
        :root {
            --tlc-yellow: #FEF200;
            --tlc-red: #E60012;
            --tlc-green: #009944;
            --bg-color: #FFFDE7;
            --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--tlc-red);
            padding-bottom: 10px;
        }

        .header h1 {
            color: var(--tlc-red);
            margin: 0;
            font-size: 2rem;
            text-shadow: 1px 1px 0px #fff;
        }

        .status-bar {
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Card Styles */
        .lotto-card {
            background: #fff;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
            border: 1px solid #ddd;
        }

        .card-header {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
        }

        .header-super { background-color: var(--tlc-green); }
        .header-big { background-color: var(--tlc-yellow); color: #d32f2f; text-shadow: 0px 0px 0px; }
        .header-539 { background-color: #2196F3; }

        .card-body {
            padding: 15px;
            text-align: center;
        }

        .info-row {
            margin-bottom: 15px;
            font-size: 0.95rem;
            color: #333;
            border-bottom: 1px dashed #eee;
            padding-bottom: 5px;
        }

        .info-label {
            font-weight: bold;
            color: #555;
        }

        /* Ball Styles */
        .balls-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .ball {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.2);
            color: #333;
        }

        .ball.green { background: radial-gradient(circle at 10px 10px, #81C784, #2E7D32); color: white; }
        .ball.yellow { background: radial-gradient(circle at 10px 10px, #FFF59D, #FBC02D); }
        .ball.red { background: radial-gradient(circle at 10px 10px, #E57373, #C62828); color: white; }
        .ball.blue { background: radial-gradient(circle at 10px 10px, #64B5F6, #1565C0); color: white; }

        .special-section {
            margin-top: 10px;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        
        .special-label {
            font-size: 0.8rem;
            color: var(--tlc-red);
            margin-bottom: 5px;
            display: block;
        }

        .loading {
            color: #999;
            font-style: italic;
        }

        .error-msg {
            color: red;
            font-size: 0.8rem;
            display: none;
        }

    </style>
</head>
<body>

    <div class="header">
        <h1>台灣彩券即時看板</h1>
        <div class="status-bar">
            最後更新: <span id="last-updated">尚未更新</span> | 下次更新: <span id="countdown">30</span> 秒
        </div>
        <div id="error-display" class="error-msg"></div>
    </div>

    <div class="container">
        <div class="lotto-card">
            <div class="card-header header-super">威力彩</div>
            <div class="card-body" id="super-lotto">
                <div class="loading">載入中...</div>
            </div>
        </div>

        <div class="lotto-card">
            <div class="card-header header-big">大樂透</div>
            <div class="card-body" id="big-lotto">
                <div class="loading">載入中...</div>
            </div>
        </div>

        <div class="lotto-card">
            <div class="card-header header-539">今彩539</div>
            <div class="card-body" id="lotto-539">
                <div class="loading">載入中...</div>
            </div>
        </div>
    </div>

    <script>
        // 設定 CORS Proxy (使用 allorigins.win，它比較穩定且免費)
        const PROXY_URL = 'https://api.allorigins.win/get?url=';
        const TARGET_URL = encodeURIComponent('https://www.taiwanlottery.com.tw/index_new.aspx');
        
        let countdown = 30;

        function updateTime() {
            const now = new Date();
            document.getElementById('last-updated').innerText = now.toLocaleString('zh-TW');
        }

        function renderBall(num, color) {
            return `<div class="ball ${color}">${num}</div>`;
        }

        function parseLottoData(doc) {
            try {
                // 1. 威力彩 (Super Lotto) - ID 通常是 contents_logo_02 區域
                const superBlock = doc.querySelector('#contents_logo_02').parentElement.parentElement;
                const superTerm = superBlock.querySelector('.font_black15').innerText.trim();
                const superDate = superBlock.querySelector('.font_black15').nextElementSibling.innerText.trim().replace('開獎日期：','');
                
                // 威力彩號碼 (第一區)
                const superBalls1 = Array.from(superBlock.querySelectorAll('.ball_tx.ball_green')).slice(0, 6).map(el => el.innerText.trim());
                // 威力彩號碼 (第二區)
                const superRed = superBlock.querySelector('.ball_red').innerText.trim();

                const superHtml = `
                    <div class="info-row">
                        <span class="info-label">期數：</span> ${superTerm}<br>
                        <span class="info-label">日期：</span> ${superDate}
                    </div>
                    <div class="balls-container">
                        ${superBalls1.map(n => renderBall(n, 'green')).join('')}
                    </div>
                    <div class="special-section">
                        <span class="special-label">第二區</span>
                        <div class="balls-container">
                            ${renderBall(superRed, 'red')}
                        </div>
                    </div>
                `;
                document.getElementById('super-lotto').innerHTML = superHtml;

                // 2. 大樂透 (Big Lotto) - ID 通常是 contents_logo_04 區域
                const bigBlock = doc.querySelector('#contents_logo_04').parentElement.parentElement;
                const bigTerm = bigBlock.querySelector('.font_black15').innerText.trim();
                const bigDate = bigBlock.querySelector('.font_black15').nextElementSibling.innerText.trim().replace('開獎日期：','');
                
                // 大樂透號碼
                const bigBalls = Array.from(bigBlock.querySelectorAll('.ball_tx.ball_yellow')).slice(0, 6).map(el => el.innerText.trim());
                const bigSpecial = bigBlock.querySelector('.ball_red').innerText.trim();

                const bigHtml = `
                    <div class="info-row">
                        <span class="info-label">期數：</span> ${bigTerm}<br>
                        <span class="info-label">日期：</span> ${bigDate}
                    </div>
                    <div class="balls-container">
                        ${bigBalls.map(n => renderBall(n, 'yellow')).join('')}
                    </div>
                    <div class="special-section">
                        <span class="special-label">特別號</span>
                        <div class="balls-container">
                            ${renderBall(bigSpecial, 'red')}
                        </div>
                    </div>
                `;
                document.getElementById('big-lotto').innerHTML = bigHtml;

                // 3. 今彩539 - ID 通常是 contents_logo_06 區域
                const c539Block = doc.querySelector('#contents_logo_06').parentElement.parentElement;
                const c539Term = c539Block.querySelector('.font_black15').innerText.trim();
                const c539Date = c539Block.querySelector('.font_black15').nextElementSibling.innerText.trim().replace('開獎日期：','');
                
                const c539Balls = Array.from(c539Block.querySelectorAll('.ball_tx.ball_lemon')).slice(0, 5).map(el => el.innerText.trim());

                const c539Html = `
                    <div class="info-row">
                        <span class="info-label">期數：</span> ${c539Term}<br>
                        <span class="info-label">日期：</span> ${c539Date}
                    </div>
                    <div class="balls-container">
                        ${c539Balls.map(n => renderBall(n, 'green')).join('')}
                    </div>
                `;
                document.getElementById('lotto-539').innerHTML = c539Html;

                // 清除錯誤訊息
                document.getElementById('error-display').style.display = 'none';

            } catch (e) {
                console.error("解析錯誤:", e);
                document.getElementById('error-display').innerText = "解析資料失敗，台彩官網可能已改版。";
                document.getElementById('error-display').style.display = 'block';
            }
        }

        async function fetchLotteryData() {
            try {
                // 重設倒數
                countdown = 30;
                
                // 透過 Proxy 抓取
                const response = await fetch(PROXY_URL + TARGET_URL);
                if (!response.ok) throw new Error('Network response was not ok');
                
                const data = await response.json();
                
                // allorigins 回傳的內容在 contents 屬性中
                const htmlText = data.contents;
                
                // 將純文字轉為 HTML Document 物件
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlText, 'text/html');

                parseLottoData(doc);
                updateTime();

            } catch (error) {
                console.error('Fetch error:', error);
                document.getElementById('error-display').innerText = "連線失敗，請稍後再試 (CORS Proxy 可能繁忙)。";
                document.getElementById('error-display').style.display = 'block';
            }
        }

        // 倒數計時器邏輯
        setInterval(() => {
            countdown--;
            if (countdown <= 0) countdown = 0;
            document.getElementById('countdown').innerText = countdown;
        }, 1000);

        // 主排程：每30秒更新一次 (30000毫秒)
        setInterval(fetchLotteryData, 30000);

        // 初次執行
        fetchLotteryData();

    </script>
</body>
</html>